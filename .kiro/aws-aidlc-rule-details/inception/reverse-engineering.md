# 逆向工程

**目的**：分析现有代码库并生成综合设计工件

**执行条件**：检测到棕地项目（在工作区中发现现有代码）

**跳过条件**：绿地项目（无现有代码）

**重新运行行为**：即使工件存在，当检测到棕地项目时也始终重新运行。这确保工件反映当前代码状态

## 步骤 1：多包发现

### 1.1 扫描工作区
- 所有包（不仅仅是提到的包）
- 通过配置文件的包关系
- 包类型：应用程序、CDK/基础设施、模型、客户端、测试

### 1.2 理解业务上下文
- 系统整体实现的核心业务
- 每个包的业务概述
- 系统中实现的业务交易列表

### 1.3 基础设施发现
- CDK 包（带有 CDK 依赖的 package.json）
- Terraform（.tf 文件）
- CloudFormation（.yaml/.json 模板）
- 部署脚本

### 1.4 构建系统发现
- 构建系统：Brazil、Maven、Gradle、npm
- 构建系统声明的配置文件
- 包之间的构建依赖关系

### 1.5 服务架构发现
- Lambda 函数（处理程序、触发器）
- 容器服务（Docker/ECS 配置）
- API 定义（Smithy 模型、OpenAPI 规范）
- 数据存储（DynamoDB、S3 等）

### 1.6 代码质量分析
- 编程语言和框架
- 测试覆盖率指标
- 代码检查配置
- CI/CD 管道

## 步骤 1：生成业务概述文档

创建 `aidlc-docs/inception/reverse-engineering/business-overview.md`：

```markdown
# 业务概述

## 业务上下文图
[显示业务上下文的 Mermaid 图表]

## 业务描述
- **业务描述**：[系统功能的整体业务描述]
- **业务交易**：[系统实现的业务交易列表及其描述]
- **业务词典**：[系统遵循的业务词典术语及其含义]

## 组件级业务描述
### [包/组件名称]
- **目的**：[从业务角度它做什么]
- **职责**：[关键职责]
```

## 步骤 2：生成架构文档

创建 `aidlc-docs/inception/reverse-engineering/architecture.md`：

```markdown
# 系统架构

## 系统概述
[系统的高级描述]

## 架构图
[显示所有包、服务、数据存储、关系的 Mermaid 图表]

## 组件描述
### [包/组件名称]
- **目的**：[它做什么]
- **职责**：[关键职责]
- **依赖关系**：[它依赖什么]
- **类型**：[应用程序/基础设施/模型/客户端/测试]

## 数据流
[关键工作流的 Mermaid 序列图]

## 集成点
- **外部 API**：[带目的的列表]
- **数据库**：[带目的的列表]
- **第三方服务**：[带目的的列表]

## 基础设施组件
- **CDK 堆栈**：[带目的的列表]
- **部署模型**：[描述]
- **网络**：[VPC、子网、安全组]
```

## 步骤 3：生成代码结构文档

创建 `aidlc-docs/inception/reverse-engineering/code-structure.md`：

```markdown
# 代码结构

## 构建系统
- **类型**：[Maven/Gradle/npm/Brazil]
- **配置**：[关键构建文件和设置]

## 关键类/模块
[Mermaid 类图或模块层次结构]

### 现有文件清单
[列出所有源文件及其目的 - 这些是棕地项目中修改的候选文件]

**示例格式**：
- `[path/to/file]` - [目的/职责]

## 设计模式
### [模式名称]
- **位置**：[使用位置]
- **目的**：[使用原因]
- **实现**：[实现方式]

## 关键依赖关系
### [依赖名称]
- **版本**：[版本号]
- **使用**：[如何和在哪里使用]
- **目的**：[为什么需要]
```

## 步骤 4：生成 API 文档

创建 `aidlc-docs/inception/reverse-engineering/api-documentation.md`：

```markdown
# API 文档

## REST API
### [端点名称]
- **方法**：[GET/POST/PUT/DELETE]
- **路径**：[/api/path]
- **目的**：[它做什么]
- **请求**：[请求格式]
- **响应**：[响应格式]

## 内部 API
### [接口/类名称]
- **方法**：[带签名的列表]
- **参数**：[参数描述]
- **返回类型**：[返回类型描述]

## 数据模型
### [模型名称]
- **字段**：[字段描述]
- **关系**：[相关模型]
- **验证**：[验证规则]
```

## 步骤 5：生成组件清单

创建 `aidlc-docs/inception/reverse-engineering/component-inventory.md`：

```markdown
# 组件清单

## 应用程序包
- [包名称] - [目的]

## 基础设施包
- [包名称] - [CDK/Terraform] - [目的]

## 共享包
- [包名称] - [模型/工具/客户端] - [目的]

## 测试包
- [包名称] - [集成/负载/单元] - [目的]

## 总计数
- **总包数**：[数量]
- **应用程序**：[数量]
- **基础设施**：[数量]
- **共享**：[数量]
- **测试**：[数量]
```

## 步骤 6：生成技术栈文档

创建 `aidlc-docs/inception/reverse-engineering/technology-stack.md`：

```markdown
# 技术栈

## 编程语言
- [语言] - [版本] - [使用]

## 框架
- [框架] - [版本] - [目的]

## 基础设施
- [服务] - [目的]

## 构建工具
- [工具] - [版本] - [目的]

## 测试工具
- [工具] - [版本] - [目的]
```

## 步骤 7：生成依赖关系文档

创建 `aidlc-docs/inception/reverse-engineering/dependencies.md`：

```markdown
# 依赖关系

## 内部依赖关系
[显示包依赖关系的 Mermaid 图表]

### [包 A] 依赖于 [包 B]
- **类型**：[编译/运行时/测试]
- **原因**：[依赖关系存在的原因]

## 外部依赖关系
### [依赖名称]
- **版本**：[版本]
- **目的**：[使用原因]
- **许可证**：[许可证类型]
```

## 步骤 8：生成代码质量评估

创建 `aidlc-docs/inception/reverse-engineering/code-quality-assessment.md`：

```markdown
# 代码质量评估

## 测试覆盖率
- **整体**：[百分比或好/一般/差/无]
- **单元测试**：[状态]
- **集成测试**：[状态]

## 代码质量指标
- **代码检查**：[已配置/未配置]
- **代码风格**：[一致/不一致]
- **文档**：[好/一般/差]

## 技术债务
- [问题描述和位置]

## 模式和反模式
- **良好模式**：[列表]
- **反模式**：[带位置的列表]
```

## 步骤 9：创建时间戳文件

创建 `aidlc-docs/inception/reverse-engineering/reverse-engineering-timestamp.md`：

```markdown
# 逆向工程元数据

**分析日期**：[ISO 时间戳]
**分析器**：AI-DLC
**工作区**：[工作区路径]
**分析的总文件数**：[数量]

## 生成的工件
- [x] architecture.md
- [x] code-structure.md
- [x] api-documentation.md
- [x] component-inventory.md
- [x] technology-stack.md
- [x] dependencies.md
- [x] code-quality-assessment.md
```

## 步骤 10：更新状态跟踪

更新 `aidlc-docs/aidlc-state.md`：

```markdown
## 逆向工程状态
- [x] 逆向工程 - 在 [时间戳] 完成
- **工件位置**：aidlc-docs/inception/reverse-engineering/
```

## 步骤 11：向用户展示完成消息

```markdown
# 🔍 逆向工程完成

[AI 生成的分析关键发现摘要，以项目符号形式]

> **📋 <u>**需要审查：**</u>**  
> 请检查逆向工程工件：`aidlc-docs/inception/reverse-engineering/`

> **🚀 <u>**下一步？**</u>**
>
> **您可以：**
>
> 🔧 **请求变更** - 如需要，要求修改逆向工程分析
> ✅ **批准并继续** - 批准分析并继续到 **需求分析**
```

## 步骤 12：等待用户批准

- **必须**：在用户明确批准之前不要继续
- **必须**：在 audit.md 中记录用户的响应，包含完整的原始输入
