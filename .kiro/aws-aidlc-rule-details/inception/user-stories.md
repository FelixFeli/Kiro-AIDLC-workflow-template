# 用户故事 - 详细步骤

## 目的
**将需求转换为以用户为中心的故事和验收标准**

用户故事专注于：
- 将业务需求转换为以用户为中心的叙述
- 为每个故事定义清晰的验收标准
- 创建代表不同利益相关者类型的用户角色
- 在团队间建立共同理解
- 为实现提供可测试的规范

## 前置条件
- 工作区检测必须完成
- 推荐需求分析（如果可用可以引用需求）
- 工作流规划必须指示应执行用户故事阶段

## 智能评估指导原则

**何时执行用户故事**：在继续之前使用此增强评估：

### 高优先级执行（始终执行）
- **新用户功能**：用户将直接交互的任何新功能
- **用户体验变更**：对现有用户工作流或界面的修改
- **多角色系统**：服务不同类型用户的应用程序
- **面向客户的API**：外部用户或系统将使用的服务
- **复杂业务逻辑**：具有多种场景或业务规则的需求
- **跨团队项目**：需要多个团队间共同理解的工作

### 中等优先级执行（评估复杂性）
- **后端用户影响**：间接影响用户体验的内部变更
- **性能改进**：具有用户可见好处的增强
- **集成工作**：连接影响用户工作流的系统
- **数据变更**：影响用户数据、报告或分析的修改
- **安全增强**：影响用户身份验证或权限的变更

### 复杂性评估因素
对于中等优先级情况，如果满足以下任何条件则执行用户故事：
- **范围**：变更跨越多个组件或用户接触点
- **歧义**：需求有不清楚的方面，故事可以澄清
- **风险**：高业务影响或误解的可能性
- **利益相关者**：多个业务利益相关者参与需求
- **测试**：将需要用户验收测试
- **选项**：存在多种有效的实现方法

### 仅跳过简单情况
- **纯重构**：对用户零影响的内部代码改进
- **孤立错误修复**：范围清晰的简单、明确定义的修复
- **仅基础设施**：无用户面向效果的变更
- **开发者工具**：构建过程、CI/CD或开发环境变更
- **文档**：不影响功能的更新

### 默认决策规则
**有疑问时，包含用户故事并提出澄清问题。** 创建带有适当澄清的全面故事的开销通常被以下好处所抵消：
- 更清晰的需求理解
- 更好的团队对齐
- 改进的测试标准
- 增强的利益相关者沟通
- 减少的实现风险
- 开发期间更少的昂贵变更
- 更好的用户体验结果

---

# 第1部分：规划

## 步骤1：验证用户故事需求（必须）

**关键**：在继续用户故事之前，执行此评估：

### 评估过程
1. **分析请求上下文**：
   - 审查原始用户请求和需求
   - 识别面向用户vs仅内部的变更
   - 评估工作的复杂性和范围
   - 评估业务利益相关者参与

2. **应用评估标准**：
   - 检查高优先级指标（始终执行）
   - 评估中等优先级因素（基于复杂性的决策）
   - 确认这不是应该跳过的简单情况

3. **记录评估决策**：
   - 创建 `aidlc-docs/inception/plans/user-stories-assessment.md`
   - 包含为什么用户故事对此请求有价值的理由
   - 引用适用的具体评估标准
   - 解释预期好处（清晰度、测试、利益相关者对齐）

4. **仅在合理时继续**：
   - 用户故事必须为项目增加明确价值
   - 评估必须显示具体好处超过开销
   - 决策应该对项目利益相关者是可辩护的

### 评估文档模板
```markdown
# 用户故事评估

## 请求分析
- **原始请求**：[简要摘要]
- **用户影响**：[直接/间接/无]
- **复杂性级别**：[简单/中等/复杂]
- **利益相关者**：[列出相关方]

## 满足的评估标准
- [ ] 高优先级：[列出适用标准]
- [ ] 中等优先级：[列出适用标准及复杂性理由]
- [ ] 好处：[用户故事的预期价值]

## 决策
**执行用户故事**：[是/否]
**理由**：[详细理由]

## 预期结果
- [列出用户故事将提供的具体好处]
- [故事如何改善项目成功]
```

## 步骤2：创建故事计划
- 承担产品负责人的角色
- 生成包含故事开发逐步执行检查清单的全面计划
- 每个步骤和子步骤都应有复选框 []
- 专注于将需求转换为用户故事的方法和方法

## 步骤3：生成适合上下文的问题
**指令**：彻底分析需求和上下文，识别所有澄清可以改善故事质量和团队理解的领域。主动提问以确保全面的用户故事开发。

**关键**：当有任何歧义或可能影响故事质量的缺失细节时，默认提问。提问过多比创建不完整或不清楚的故事要好。

**参见 `common/question-format-guide.md` 获取问题格式规则**

- 使用 [Answer]: 标签格式嵌入问题
- 专注于任何歧义、缺失信息或需要澄清的领域
- 在用户输入可以改善故事创建决策的地方生成问题
- **有疑问时，提出问题** - 过度自信导致糟糕的故事

**要评估的问题类别**（考虑所有类别）：
- **用户角色** - 询问用户类型、角色、特征和动机
- **故事粒度** - 询问适当的详细程度、故事大小和分解方法
- **故事格式** - 询问格式偏好、模板使用和文档标准
- **分解方法** - 询问组织方法、优先级和分组策略
- **验收标准** - 询问详细程度、格式、测试方法和验证方法
- **用户旅程** - 询问用户工作流、交互模式和体验流程
- **业务上下文** - 询问业务目标、成功指标和利益相关者需求
- **技术约束** - 询问技术限制、集成需求和系统边界

## 步骤4：在计划中包含必需的故事工件
- **始终**在故事计划中包含这些必需工件：
  - [ ] 生成遵循INVEST标准的用户故事的stories.md
  - [ ] 生成包含用户原型和特征的personas.md
  - [ ] 确保故事是独立的、可协商的、有价值的、可估算的、小的、可测试的
  - [ ] 为每个故事包含验收标准
  - [ ] 将角色映射到相关用户故事

## 步骤5：呈现故事选项
- 在计划文档中包含故事分解的不同方法：
  - **基于用户旅程**：故事遵循用户工作流和交互
  - **基于功能**：围绕系统功能和能力组织故事
  - **基于角色**：按不同用户类型及其需求分组故事
  - **基于领域**：围绕业务领域或上下文组织故事
  - **基于史诗**：将故事结构化为分层史诗和子故事
- 解释每种方法的权衡和好处
- 允许具有明确决策标准的混合方法

## 步骤6：存储故事计划
- 将包含嵌入问题的完整故事计划保存在 `aidlc-docs/inception/plans/` 目录中
- 文件名：`story-generation-plan.md`
- 包含所有用户输入的 [Answer]: 标签
- 确保计划全面并涵盖所有故事开发方面

## 步骤7：请求用户输入
- 要求用户直接在故事计划文档中填写所有 [Answer]: 标签
- 强调审计跟踪和决策文档的重要性
- 提供如何填写 [Answer]: 标签的清晰说明
- 解释在继续之前必须回答所有问题

## 步骤8：收集答案
- 等待用户使用文档中的 [Answer]: 标签提供所有问题的答案
- 在所有 [Answer]: 标签完成之前不要继续
- 审查文档以确保没有 [Answer]: 标签留空

## 步骤9：分析答案（必须）
在继续之前，您必须仔细审查所有用户答案：
- **模糊或歧义响应**："混合"、"介于之间"、"不确定"、"取决于"、"也许"、"可能"
- **未定义的标准或术语**：引用没有明确定义的概念
- **矛盾答案**：相互冲突的响应
- **缺失生成细节**：缺乏实现具体指导的答案
- **组合选项的答案**：在没有明确决策规则的情况下合并不同方法的响应
- **不完整解释**：引用外部因素但未定义它们的答案
- **基于假设的响应**：假设未明确说明的知识的答案

## 步骤10：必需的后续问题
如果步骤9中的分析揭示任何模糊答案，您必须：
- 使用 [Answer]: 标签创建单独的澄清问题文件
- 在所有歧义完全解决之前不要进入批准阶段
- **关键**：要彻底 - 为每个不清楚的响应提出后续问题
- 必需后续问题的示例：
  - "您提到'A和B的混合' - 什么具体标准应该确定何时使用A vs B？"
  - "您说'介于A和B之间' - 您能定义确切的中间立场方法吗？"
  - "您表示'不确定' - 什么额外信息会帮助您决定？"
  - "您提到'取决于复杂性' - 您如何定义复杂性级别和阈值？"
  - "您选择'混合方法' - 何时使用每种方法的具体规则是什么？"
  - "您说'可能X' - 什么因素会使它绝对是X vs绝对不是X？"
  - "您引用'标准实践' - 您能定义那个标准实践是什么吗？"

## 步骤11：避免实现细节
- 专注于故事创建方法，而不是优先级或开发任务
- 在此阶段不讨论技术生成
- 避免创建开发时间线或冲刺规划
- 保持对故事结构和格式决策的关注

## 步骤12：记录批准提示
- 在要求批准之前，在 `aidlc-docs/audit.md` 中记录提示和时间戳
- 包含完整的批准提示文本
- 使用ISO 8601时间戳格式

## 步骤13：等待计划的明确批准
- 在用户明确批准故事方法之前不要继续
- 批准必须清晰明确
- 如果用户请求更改，更新计划并重复批准过程

## 步骤14：记录批准响应
- 在 `aidlc-docs/audit.md` 中记录用户的批准响应和时间戳
- 包含确切的用户响应文本
- 清楚标记批准状态

---

# 第2部分：生成

## 步骤15：加载故事生成计划
- [ ] 从 `aidlc-docs/inception/plans/story-generation-plan.md` 读取完整的故事计划
- [ ] 识别下一个未完成的步骤（第一个 [ ] 复选框）
- [ ] 为该步骤加载上下文和需求

## 步骤16：执行当前步骤
- [ ] 准确执行当前步骤描述的内容
- [ ] 按计划中指定的生成故事工件
- [ ] 遵循规划中批准的方法和格式
- [ ] 使用计划中指定的故事分解方法

## 步骤17：更新进度
- [ ] 在故事生成计划中将完成的步骤标记为 [x]
- [ ] 更新 `aidlc-docs/aidlc-state.md` 当前状态
- [ ] 保存所有生成的工件

## 步骤18：继续或完成生成
- [ ] 如果还有更多步骤，返回步骤14
- [ ] 如果所有步骤完成，验证故事已准备好进入下一阶段
- [ ] 确保所有必需工件已生成

## 步骤19：记录批准提示
- 在要求批准之前，在 `aidlc-docs/audit.md` 中记录提示和时间戳
- 包含完整的批准提示文本
- 使用ISO 8601时间戳格式

## 步骤20：呈现完成消息
- 按此结构呈现完成消息：
     1. **完成公告**（必须）：始终以此开始：

```markdown
# 📚 用户故事完成
```

     2. **AI摘要**（可选）：提供生成故事的结构化要点摘要
        - 格式："用户故事生成已创建[描述]："
        - 列出生成的关键角色（要点）
        - 列出创建的用户故事及计数和组织
        - 提及故事结构和合规性（INVEST标准、验收标准）
        - 不要包含工作流指令（"请审查"、"让我知道"、"进入下一阶段"、"在我们继续之前"）
        - 保持事实和内容导向
     3. **格式化工作流消息**（必须）：始终以此确切格式结束：

```markdown
> **📋 <u>**需要审查：**</u>**  
> 请检查用户故事和角色：`aidlc-docs/inception/user-stories/stories.md` 和 `aidlc-docs/inception/user-stories/personas.md`



> **🚀 <u>**下一步？**</u>**
>
> **您可以：**
>
> 🔧 **请求变更** - 基于您的审查要求修改故事或角色  
> ✅ **批准并继续** - 批准用户故事并进入**工作流规划**

---
```

## 步骤21：等待生成故事的明确批准
- 在用户明确批准生成的故事之前不要继续
- 批准必须清晰明确
- 如果用户请求更改，更新故事并重复批准过程

## 步骤22：记录批准响应
- 在 `aidlc-docs/audit.md` 中记录用户的批准响应和时间戳
- 包含确切的用户响应文本
- 清楚标记批准状态

## 步骤23：更新进度
- 在 `aidlc-state.md` 中将用户故事阶段标记为完成
- 更新"当前状态"部分
- 准备转换到下一阶段

---

# 关键规则

## 规划阶段规则
- **适合上下文的问题**：只询问与此特定上下文相关的问题
- **必需答案分析**：在继续之前始终分析答案的歧义
- **不带歧义继续**：在生成之前必须解决所有模糊答案
- **需要明确批准**：用户必须在生成开始前批准计划

## 生成阶段规则
- **无硬编码逻辑**：只执行故事生成计划中写的内容
- **严格遵循计划**：不要偏离步骤序列
- **更新复选框**：完成每个步骤后立即标记 [x]
- **使用批准的方法**：遵循规划中的故事方法
- **验证完成**：在继续之前确保所有故事工件完整

## 完成标准
- 所有规划问题已回答且歧义已解决
- 故事计划已被用户明确批准
- 故事生成计划中的所有步骤标记为 [x]
- 根据计划生成所有故事工件（stories.md、personas.md）
- 生成的故事已被用户明确批准
- 故事已验证并准备好进入下一阶段
