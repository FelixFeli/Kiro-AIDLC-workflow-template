# NFR 设计

## 先决条件
- 单元的 NFR 需求必须完成
- NFR 需求工件必须可用
- 执行计划必须指示应执行 NFR 设计阶段

## 概述
使用模式和逻辑组件将 NFR 需求纳入单元设计。

## 执行步骤

### 步骤 1：分析 NFR 需求
- 从 `aidlc-docs/construction/{unit-name}/nfr-requirements/` 读取 NFR 需求
- 理解可扩展性、性能、可用性、安全性需求

### 步骤 2：创建 NFR 设计计划
- 生成带复选框 [] 的 NFR 设计计划
- 专注于设计模式和逻辑组件
- 每个步骤都应该有复选框 []

### 步骤 3：生成上下文相关的问题
**指令**：分析 NFR 需求，仅生成与此特定单元的 NFR 设计相关的问题。使用以下类别作为灵感，而不是强制性检查清单。如果不适用，跳过整个类别。

- 使用 [Answer]: 标签格式嵌入问题
- 专注于此单元特定的歧义和缺失信息
- 仅在模式和组件决策需要用户输入时生成问题

**示例问题类别**（根据需要调整）：
- **弹性模式** - 仅当容错方法需要澄清时
- **可扩展性模式** - 仅当扩展机制不清楚时
- **性能模式** - 仅当性能优化策略模糊时
- **安全模式** - 仅当安全实现方法需要输入时
- **逻辑组件** - 仅当基础设施组件（队列、缓存等）需要澄清时

### 步骤 4：存储计划
- 保存为 `aidlc-docs/construction/plans/{unit-name}-nfr-design-plan.md`
- 包含所有用户输入的 [Answer]: 标签

### 步骤 5：收集和分析答案
- 等待用户完成所有 [Answer]: 标签
- 审查模糊或含糊的响应
- 如需要，添加后续问题

### 步骤 6：生成 NFR 设计工件
- 创建 `aidlc-docs/construction/{unit-name}/nfr-design/nfr-design-patterns.md`
- 创建 `aidlc-docs/construction/{unit-name}/nfr-design/logical-components.md`

### 步骤 7：展示完成消息
- 按此结构展示完成消息：
     1. **完成公告**（必需）：始终以此开始：

```markdown
# 🎨 NFR 设计完成 - [unit-name]
```

     2. **AI 摘要**（可选）：提供 NFR 设计的结构化项目符号摘要
        - 格式："NFR 设计已纳入 [描述]："
        - 列出实现的关键设计模式（项目符号）
        - 列出逻辑组件和基础设施元素
        - 提及应用的弹性、可扩展性和性能模式
        - 不要包含工作流指令（"请审查"、"让我知道"、"继续下一阶段"、"在我们继续之前"）
        - 保持事实性和内容导向
     3. **格式化工作流消息**（必需）：始终以此确切格式结束：

```markdown
> **📋 <u>**需要审查：**</u>**  
> 请检查 NFR 设计：`aidlc-docs/construction/[unit-name]/nfr-design/`



> **🚀 <u>**下一步？**</u>**
>
> **您可以：**
>
> 🔧 **请求变更** - 根据您的审查要求修改 NFR 设计  
> ✅ **继续下一阶段** - 批准 NFR 设计并继续到 **[next-stage-name]**

---
```

### 步骤 8：等待明确批准
- 在用户明确批准 NFR 设计之前不要继续
- 批准必须清楚明确
- 如果用户请求变更，更新设计并重复批准过程

### 步骤 9：记录批准并更新进度
- 在 audit.md 中记录批准和时间戳
- 记录用户的批准响应和时间戳
- 在 aidlc-state.md 中标记 NFR 设计阶段完成
