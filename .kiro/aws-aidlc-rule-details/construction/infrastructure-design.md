# 基础设施设计

## 先决条件
- 单元的功能设计必须完成
- 推荐 NFR 设计（提供要映射的逻辑组件）
- 执行计划必须指示应执行基础设施设计阶段

## 概述
将逻辑软件组件映射到部署环境的实际基础设施选择。

## 执行步骤

### 步骤 1：分析设计工件
- 从 `aidlc-docs/construction/{unit-name}/functional-design/` 读取功能设计
- 从 `aidlc-docs/construction/{unit-name}/nfr-design/` 读取 NFR 设计（如果存在）
- 识别需要基础设施的逻辑组件

### 步骤 2：创建基础设施设计计划
- 生成带复选框 [] 的基础设施设计计划
- 专注于映射到实际服务（AWS、Azure、GCP、本地）
- 每个步骤都应该有复选框 []

### 步骤 3：生成上下文相关的问题
**指令**：分析功能和 NFR 设计，仅生成与此特定单元的基础设施需求相关的问题。使用以下类别作为灵感，而不是强制性检查清单。如果不适用，跳过整个类别。

- 使用 [Answer]: 标签格式嵌入问题
- 专注于此单元特定的歧义和缺失信息
- 仅在基础设施决策需要用户输入时生成问题

**示例问题类别**（根据需要调整）：
- **部署环境** - 仅当云提供商或环境设置不清楚时
- **计算基础设施** - 仅当计算服务选择需要澄清时
- **存储基础设施** - 仅当数据库或存储选择模糊时
- **消息基础设施** - 仅当消息/队列服务需要规范时
- **网络基础设施** - 仅当负载均衡或 API 网关方法不清楚时
- **监控基础设施** - 仅当可观察性工具需要澄清时
- **共享基础设施** - 仅当基础设施共享策略模糊时

### 步骤 4：存储计划
- 保存为 `aidlc-docs/construction/plans/{unit-name}-infrastructure-design-plan.md`
- 包含所有用户输入的 [Answer]: 标签

### 步骤 5：收集和分析答案
- 等待用户完成所有 [Answer]: 标签
- 审查模糊或含糊的响应
- 如需要，添加后续问题

### 步骤 6：生成基础设施设计工件
- 创建 `aidlc-docs/construction/{unit-name}/infrastructure-design/infrastructure-design.md`
- 创建 `aidlc-docs/construction/{unit-name}/infrastructure-design/deployment-architecture.md`
- 如果有共享基础设施：创建 `aidlc-docs/construction/shared-infrastructure.md`

### 步骤 7：展示完成消息
- 按此结构展示完成消息：
     1. **完成公告**（必需）：始终以此开始：

```markdown
# 🏢 基础设施设计完成 - [unit-name]
```

     2. **AI 摘要**（可选）：提供基础设施设计的结构化项目符号摘要
        - 格式："基础设施设计已映射 [描述]："
        - 列出关键基础设施服务和组件（项目符号）
        - 列出部署架构决策和理由
        - 提及云提供商选择和服务映射
        - 不要包含工作流指令（"请审查"、"让我知道"、"继续下一阶段"、"在我们继续之前"）
        - 保持事实性和内容导向
     3. **格式化工作流消息**（必需）：始终以此确切格式结束：

```markdown
> **📋 <u>**需要审查：**</u>**  
> 请检查基础设施设计：`aidlc-docs/construction/[unit-name]/infrastructure-design/`



> **🚀 <u>**下一步？**</u>**
>
> **您可以：**
>
> 🔧 **请求变更** - 根据您的审查要求修改基础设施设计  
> ✅ **继续下一阶段** - 批准基础设施设计并继续到 **代码生成**

---
```

### 步骤 8：等待明确批准
- 在用户明确批准基础设施设计之前不要继续
- 批准必须清楚明确
- 如果用户请求变更，更新设计并重复批准过程

### 步骤 9：记录批准并更新进度
- 在 audit.md 中记录批准和时间戳
- 记录用户的批准响应和时间戳
- 在 aidlc-state.md 中标记基础设施设计阶段完成
