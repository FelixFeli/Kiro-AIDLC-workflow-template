# 功能设计

## 目的
**每单元的详细业务逻辑设计**

功能设计专注于：
- 单元的详细业务逻辑和算法
- 具有实体和关系的领域模型
- 详细的业务规则、验证逻辑和约束
- 技术无关的设计（无基础设施关注）

**注意**：这建立在应用程序设计（启动阶段）的高级组件设计基础上

## 先决条件
- 单元生成必须完成
- 工作单元工件必须可用
- 推荐应用程序设计（提供高级组件结构）
- 执行计划必须指示应执行功能设计阶段

## 概述
为单元设计详细的业务逻辑，技术无关且纯粹专注于业务功能。

## 执行步骤

### 步骤 1：分析单元上下文
- 从 `aidlc-docs/inception/application-design/unit-of-work.md` 读取单元定义
- 从 `aidlc-docs/inception/application-design/unit-of-work-story-map.md` 读取分配的故事
- 理解单元职责和边界

### 步骤 2：创建功能设计计划
- 生成带复选框 [] 的功能设计计划
- 专注于业务逻辑、领域模型、业务规则
- 每个步骤都应该有复选框 []

### 步骤 3：生成上下文相关的问题
**指令**：彻底分析单元定义和功能设计工件，识别所有澄清可以改进功能设计的领域。在提问以确保全面理解方面要积极主动。

**关键**：当存在任何可能影响功能设计质量的歧义或缺失细节时，默认提问。问太多问题比做出错误假设要好。

- 使用 [Answer]: 标签格式嵌入问题
- 专注于任何歧义、缺失信息或需要澄清的领域
- 在用户输入可以改进功能设计决策的任何地方生成问题
- **有疑问时，提出问题** - 过度自信导致糟糕的设计

**要考虑的问题类别**（评估所有类别）：
- **业务逻辑建模** - 询问核心实体、工作流、数据转换和业务流程
- **领域模型** - 询问领域概念、实体关系、数据结构和业务对象
- **业务规则** - 询问决策规则、验证逻辑、约束和业务策略
- **数据流** - 询问数据输入、输出、转换和持久化要求
- **集成点** - 询问外部系统交互、API 和数据交换
- **错误处理** - 询问错误场景、验证失败和异常处理
- **业务场景** - 询问边缘情况、替代流程和复杂业务情况

### 步骤 4：存储计划
- 保存为 `aidlc-docs/construction/plans/{unit-name}-functional-design-plan.md`
- 包含所有用户输入的 [Answer]: 标签

### 步骤 5：收集和分析答案
- 等待用户完成所有 [Answer]: 标签
- **必需**：仔细审查所有响应中的模糊或含糊答案
- **关键**：为任何不清楚的响应添加后续问题 - 不要在有歧义的情况下继续
- 寻找"取决于"、"也许"、"不确定"、"混合"、"介于之间"等响应
- 如果检测到任何歧义，创建澄清问题文件
- **在所有歧义解决之前不要继续**

### 步骤 6：生成功能设计工件
- 创建 `aidlc-docs/construction/{unit-name}/functional-design/business-logic-model.md`
- 创建 `aidlc-docs/construction/{unit-name}/functional-design/business-rules.md`
- 创建 `aidlc-docs/construction/{unit-name}/functional-design/domain-entities.md`

### 步骤 7：展示完成消息
- 按此结构展示完成消息：
     1. **完成公告**（必需）：始终以此开始：

```markdown
# 🔧 功能设计完成 - [unit-name]
```

     2. **AI 摘要**（可选）：提供功能设计的结构化项目符号摘要
        - 格式："功能设计已创建 [描述]："
        - 列出关键业务逻辑模型和实体（项目符号）
        - 列出定义的业务规则和验证逻辑
        - 提及领域模型结构和关系
        - 不要包含工作流指令（"请审查"、"让我知道"、"继续下一阶段"、"在我们继续之前"）
        - 保持事实性和内容导向
     3. **格式化工作流消息**（必需）：始终以此确切格式结束：

```markdown
> **📋 <u>**需要审查：**</u>**  
> 请检查功能设计工件：`aidlc-docs/construction/[unit-name]/functional-design/`



> **🚀 <u>**下一步？**</u>**
>
> **您可以：**
>
> 🔧 **请求变更** - 根据您的审查要求修改功能设计  
> ✅ **继续下一阶段** - 批准功能设计并继续到 **[next-stage-name]**

---
```

### 步骤 8：等待明确批准
- 在用户明确批准功能设计之前不要继续
- 批准必须清楚明确
- 如果用户请求变更，更新设计并重复批准过程

### 步骤 9：记录批准并更新进度
- 在 audit.md 中记录批准和时间戳
- 记录用户的批准响应和时间戳
- 在 aidlc-state.md 中标记功能设计阶段完成
