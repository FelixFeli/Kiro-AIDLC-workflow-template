# NFR 需求

## 先决条件
- 单元的功能设计必须完成
- 单元功能设计工件必须可用
- 执行计划必须指示应执行 NFR 需求阶段

## 概述
确定单元的非功能需求并做出技术栈选择。

## 执行步骤

### 步骤 1：分析功能设计
- 从 `aidlc-docs/construction/{unit-name}/functional-design/` 读取功能设计工件
- 理解业务逻辑复杂性和需求

### 步骤 2：创建 NFR 需求计划
- 生成带复选框 [] 的 NFR 评估计划
- 专注于可扩展性、性能、可用性、安全性
- 每个步骤都应该有复选框 []

### 步骤 3：生成上下文相关的问题
**指令**：彻底分析功能设计，识别所有 NFR 澄清可以改进系统质量和架构决策的领域。在提问以确保全面的 NFR 覆盖方面要积极主动。

**关键**：当存在任何可能影响系统质量的歧义或缺失细节时，默认提问。问太多问题比做出错误的 NFR 假设要好。

- 使用 [Answer]: 标签格式嵌入问题
- 专注于任何歧义、缺失信息或需要澄清的领域
- 在用户输入可以改进 NFR 和技术栈决策的任何地方生成问题
- **有疑问时，提出问题** - 过度自信导致糟糕的系统质量

**要评估的问题类别**（考虑所有类别）：
- **可扩展性需求** - 询问预期负载、增长模式、扩展触发器和容量规划
- **性能需求** - 询问响应时间、吞吐量、延迟和性能基准
- **可用性需求** - 询问正常运行时间期望、灾难恢复、故障转移和业务连续性
- **安全需求** - 询问数据保护、合规性、身份验证、授权和威胁模型
- **技术栈选择** - 询问技术偏好、约束、现有系统和集成需求
- **可靠性需求** - 询问错误处理、容错、监控和警报需求
- **可维护性需求** - 询问代码质量、文档、测试和运营需求
- **可用性需求** - 询问用户体验、可访问性和界面需求

### 步骤 4：存储计划
- 保存为 `aidlc-docs/construction/plans/{unit-name}-nfr-requirements-plan.md`
- 包含所有用户输入的 [Answer]: 标签

### 步骤 5：收集和分析答案
- 等待用户完成所有 [Answer]: 标签
- **必需**：仔细审查所有响应中的模糊或含糊答案
- **关键**：为任何不清楚的响应添加后续问题 - 不要在有歧义的情况下继续
- 寻找"取决于"、"也许"、"不确定"、"混合"、"介于之间"、"标准"、"典型"等响应
- 如果检测到任何歧义，创建澄清问题文件
- **在所有歧义解决之前不要继续**

### 步骤 6：生成 NFR 需求工件
- 创建 `aidlc-docs/construction/{unit-name}/nfr-requirements/nfr-requirements.md`
- 创建 `aidlc-docs/construction/{unit-name}/nfr-requirements/tech-stack-decisions.md`

### 步骤 7：展示完成消息
- 按此结构展示完成消息：
     1. **完成公告**（必需）：始终以此开始：

```markdown
# 📊 NFR 需求完成 - [unit-name]
```

     2. **AI 摘要**（可选）：提供 NFR 需求的结构化项目符号摘要
        - 格式："NFR 需求评估已识别 [描述]："
        - 列出关键可扩展性、性能、可用性需求（项目符号）
        - 列出识别的安全和合规需求
        - 提及技术栈决策和理由
        - 不要包含工作流指令（"请审查"、"让我知道"、"继续下一阶段"、"在我们继续之前"）
        - 保持事实性和内容导向
     3. **格式化工作流消息**（必需）：始终以此确切格式结束：

```markdown
> **📋 <u>**需要审查：**</u>**  
> 请检查 NFR 需求：`aidlc-docs/construction/[unit-name]/nfr-requirements/`



> **🚀 <u>**下一步？**</u>**
>
> **您可以：**
>
> 🔧 **请求变更** - 根据您的审查要求修改 NFR 需求  
> ✅ **继续下一阶段** - 批准 NFR 需求并继续到 **[next-stage-name]**

---
```

### 步骤 8：等待明确批准
- 在用户明确批准 NFR 需求之前不要继续
- 批准必须清楚明确
- 如果用户请求变更，更新需求并重复批准过程

### 步骤 9：记录批准并更新进度
- 在 audit.md 中记录批准和时间戳
- 记录用户的批准响应和时间戳
- 在 aidlc-state.md 中标记 NFR 需求阶段完成
